 /* 상품 */
CREATE TABLE PRODUCT (
	pId INT PRIMARY KEY AUTO_INCREMENT, /* 상품번호 */
	typeCode VARCHAR(20) NOT NULL, /* 분류코드 */
	pName VARCHAR(100) NOT NULL, /* 상품명 */
	price INT NOT NULL, /* 단가 */
	brand VARCHAR(100) NOT NULL, /* 브랜드 */
	description VARCHAR(300), /* 상세설명 */
	thumbnail VARCHAR(300), /* 썸네일 */
	image VARCHAR(300) /* 이미지 */
);

/* 상품 분류 */
CREATE TABLE PRODUCTTYPE (
	typeCode VARCHAR(20) PRIMARY KEY, /* 분류코드 */
	tName VARCHAR(30) NOT NULL, /* 분류명 */
	tNameEng VARCHAR(30) NOT NULL /* 분류명영문 */
);

/* 포인트 */
CREATE TABLE POINT (
	mId VARCHAR(30) PRIMARY KEY, /* ID */
	currentPOINT INT DEFAULT 0 NOT NULL, /* 포인트 */
	updateDate DATETIME NOT NULL /* 변동일 */
);

/* 회원관리 */
CREATE TABLE MEMBER (
	mId VARCHAR(30) PRIMARY KEY, /* ID */
	pw VARCHAR(50) NOT NULL, /* 비밀번호 */
	mName VARCHAR(20) NOT NULL, /* 이름 */
	phone VARCHAR(20), /* 전화번호 */
	address VARCHAR(200), /* 주소 */
	email VARCHAR(100) UNIQUE, /* 이메일 */
	regDate DATETIME DEFAULT current_timestamp, /* 가입일 */
	mLevel INT DEFAULT 1 /* 회원등급 */
);

/* 리뷰게시판 */
CREATE TABLE REVIEW (
	rNo INT PRIMARY KEY AUTO_INCREMENT, /* 리뷰번호 */
	mId VARCHAR(30) NOT NULL, /* ID */
	pId INT NOT NULL, /* 상품번호 */
	content VARCHAR(1000) NOT NULL, /* 리뷰 내용 */
	regDate DATETIME DEFAULT current_timestamp /* 리뷰 작성일 */
);

/* 리뷰게시판 댓글 */
CREATE TABLE REVIEWCOMMENT (
	rcNo INT PRIMARY KEY AUTO_INCREMENT, /* 리뷰댓글번호 */
	rNo INT NOT NULL, /* 리뷰번호 */
	mId VARCHAR(30) NOT NULL, /* ID */
	pId INT, /* 상품번호 */
	regDate DATETIME DEFAULT current_timestamp, /* 댓글 작성일 */
	content VARCHAR(1000) NOT NULL /* 댓글 내용 */
);

/* 자유/커뮤니티 게시판 */
CREATE TABLE COMMUNITY (
	cNo INT PRIMARY KEY AUTO_INCREMENT, /* 번호 */
	mId VARCHAR(30) NOT NULL, /* ID */
	mLevel INT, /* 회원등급 */
	title VARCHAR(100) NOT NULL, /* 제목 */
	content VARCHAR(1000) NOT NULL, /* 내용 */
	regDate DATETIME DEFAULT current_timestamp /* 작성일 */
);

/* 회원 장바구니 */
CREATE TABLE USERCART (
	ucId INT PRIMARY KEY AUTO_INCREMENT, /* 장바구니번호 */
	mId VARCHAR(30) NOT NULL, /* ID */
	pId INT NOT NULL, /* 상품번호 */
	cquantity INT /* 상품수량 */
);

/* 회원 주문 */
CREATE TABLE USERORDER (
	oId INT PRIMARY KEY AUTO_INCREMENT, /* 주문번호 */
	mId VARCHAR(30) NOT NULL, /* ID */
	pId INT NOT NULL, /* 상품번호 */
	quantity INT NOT NULL, /* 상품수량 */
	oDate DATE, /* 주문날짜 */
	price INT, /* 가격 */
	statusCode VARCHAR(20) NOT NULL /* 상태코드 */
);

/* 주문상태 */
CREATE TABLE STATUSTYPE (
	statusCode VARCHAR(20) PRIMARY KEY, /* 상태코드 */
	statusName VARCHAR(50) NOT NULL /* 상태명 */
);

/* 리뷰게시판 첨부 */
CREATE TABLE FILENAME_TBL (
	rNo INT PRIMARY KEY, /* 리뷰번호 */
	savedfilename VARCHAR(1000) /* 새 컬럼 */
);

ALTER TABLE PRODUCT
	ADD FOREIGN KEY (
			typeCode
		)
		REFERENCES PRODUCTtype (
			typeCode
		);

ALTER TABLE POINT
	ADD
		FOREIGN KEY (
			mId
		)
		REFERENCES Member (
			mId
		)
		ON DELETE CASCADE;

ALTER TABLE REVIEW
	ADD

		FOREIGN KEY (
			pId
		)
		REFERENCES PRODUCT (
			pId
		);

ALTER TABLE REVIEW
	ADD

		FOREIGN KEY (
			mId
		)
		REFERENCES Member (
			mId
		);

ALTER TABLE REVIEWcomment
	ADD

		FOREIGN KEY (
			rNo
		)
		REFERENCES REVIEW (
			rNo
		);

ALTER TABLE REVIEWcomment
	ADD

		FOREIGN KEY (
			mId
		)
		REFERENCES Member (
			mId
		);

ALTER TABLE Community
	ADD FOREIGN KEY (
			mId
		)
		REFERENCES Member (
			mId
		);

ALTER TABLE USERCART
	ADD	FOREIGN KEY (
			mId
		)
		REFERENCES Member (
			mId
		);

ALTER TABLE USERCART
	ADD	FOREIGN KEY (
			pId
		)
		REFERENCES PRODUCT (
			pId
		);

ALTER TABLE USERORDER
	ADD	FOREIGN KEY (
			mId
		)
		REFERENCES Member (
			mId
		);

ALTER TABLE USERORDER
	ADD	FOREIGN KEY (
			pId
		)
		REFERENCES PRODUCT (
			pId
		);

ALTER TABLE USERORDER
	ADD	FOREIGN KEY (
			statusCode
		)
		REFERENCES StatusType (
			statusCode
		);

ALTER TABLE FILENAME_TBL
	ADD	FOREIGN KEY (
			rNo
		)
		REFERENCES REVIEW (
			rNo
		);

/* 샘플 데이터 */
-- PRODUCTTYPE
INSERT INTO PRODUCTTYPE VALUES('1', '한식', 'Korean food');
INSERT INTO PRODUCTTYPE VALUES('2', '양식', 'Western Food');
INSERT INTO PRODUCTTYPE VALUES('3', '중식', 'Chinese Food');
INSERT INTO PRODUCTTYPE VALUES('4', '일식', 'Japanese Food');
INSERT INTO PRODUCTTYPE VALUES('5', '기타', 'etc');


-- 관리자 계정 생성
INSERT INTO MEMBER(MID, PW, MNAME, EMAIL, REGDATE, MLEVEL)
    VALUES('admin', '1111', '관리자', 'kh361@naver.com', now(), 2);
-- 관리자 계정 포인트 생성
INSERT INTO POINT
    VALUES('admin', 999999999, now());

-- STATUSTYPE
INSERT INTO StatusType Values ('1','주문 확인');
INSERT INTO StatusType Values ('2','상품 준비 중');
INSERT INTO StatusType Values ('3','배송 준비 중');
INSERT INTO StatusType Values ('4','배송 중');
INSERT INTO StatusType Values ('5','배송 완료');
INSERT INTO StatusType Values ('6','주문 취소');
INSERT INTO StatusType Values ('7','반품 처리');
INSERT INTO StatusType Values ('8','교환 처리');

-- COMMUNITY_FILE
CREATE TABLE COMMUNITY_FILE(
    FILE_NO INT PRIMARY KEY AUTO_INCREMENT,
    CNO INT NOT NULL,
    ORG_FILE_NAME VARCHAR(260) NOT NULL,
    STORED_FILE_NAME VARCHAR(36) NOT NULL,
    FILE_SIZE INT,
    REGDATE DATETIME DEFAULT current_timestamp,
    DEL_GB VARCHAR(1) DEFAULT 'N' NOT NULL
);
