 /* 상품 */
CREATE TABLE PRODUCT (
	PID INT PRIMARY KEY AUTO_INCREMENT, /* 상품번호 */
	TYPECODE VARCHAR(20) NOT NULL, /* 분류코드 */
	PNAME VARCHAR(100) NOT NULL, /* 상품명 */
	PRICE INT NOT NULL, /* 단가 */
	BRAND VARCHAR(100) NOT NULL, /* 브랜드 */
	DESCRIPTION VARCHAR(300), /* 상세설명 */
	THUMBNAIL VARCHAR(300), /* 썸네일 */
	IMAGE VARCHAR(300) /* 이미지 */
);

/* 상품 분류 */
CREATE TABLE PRODUCTTYPE (
	TYPECODE VARCHAR(20) PRIMARY KEY, /* 분류코드 */
	TNAME VARCHAR(30) NOT NULL, /* 분류명 */
	TNAMEENG VARCHAR(30) NOT NULL /* 분류명영문 */
);

/* 포인트 */
CREATE TABLE POINT (
	MID VARCHAR(30) PRIMARY KEY, /* ID */
	CURRENTPOINT INT DEFAULT 0 NOT NULL, /* 포인트 */
	UPDATEDATE DATETIME NOT NULL /* 변동일 */
);

/* 회원관리 */
CREATE TABLE MEMBER (
	MID VARCHAR(30) PRIMARY KEY, /* ID */
	PW VARCHAR(50) NOT NULL, /* 비밀번호 */
	MNAME VARCHAR(20) NOT NULL, /* 이름 */
	PHONE VARCHAR(20), /* 전화번호 */
	ADDRESS VARCHAR(200), /* 주소 */
	EMAIL VARCHAR(100) UNIQUE, /* 이메일 */
	REGDATE DATETIME DEFAULT current_timestamp, /* 가입일 */
	MLEVEL INT DEFAULT 1 /* 회원등급 */
);

/* 리뷰게시판 */
CREATE TABLE REVIEW (
	RNO INT PRIMARY KEY AUTO_INCREMENT, /* 리뷰번호 */
	MID VARCHAR(30) NOT NULL, /* ID */
	PID INT NOT NULL, /* 상품번호 */
	CONTENT VARCHAR(1000) NOT NULL, /* 리뷰 내용 */
	REGDATE DATETIME DEFAULT current_timestamp /* 리뷰 작성일 */
);

/* 리뷰게시판 댓글 */
CREATE TABLE REVIEWCOMMENT (
	RCNO INT PRIMARY KEY AUTO_INCREMENT, /* 리뷰댓글번호 */
	RNO INT NOT NULL, /* 리뷰번호 */
	MID VARCHAR(30) NOT NULL, /* ID */
	PID INT, /* 상품번호 */
	REGDATE DATETIME DEFAULT current_timestamp, /* 댓글 작성일 */
	CONTENT VARCHAR(1000) NOT NULL /* 댓글 내용 */
);

/* 자유/커뮤니티 게시판 */
CREATE TABLE COMMUNITY (
	CNO INT PRIMARY KEY AUTO_INCREMENT, /* 번호 */
	MID VARCHAR(30) NOT NULL, /* ID */
	MLEVEL INT, /* 회원등급 */
	TITLE VARCHAR(100) NOT NULL, /* 제목 */
	CONTENT VARCHAR(1000) NOT NULL, /* 내용 */
	REGDATE DATETIME DEFAULT current_timestamp /* 작성일 */
);

/* 회원 장바구니 */
CREATE TABLE USERCART (
	UCID INT PRIMARY KEY AUTO_INCREMENT, /* 장바구니번호 */
	MID VARCHAR(30) NOT NULL, /* ID */
	PID INT NOT NULL, /* 상품번호 */
	CQUANTITY INT /* 상품수량 */
);

/* 회원 주문 */
CREATE TABLE USERORDER (
	OID INT PRIMARY KEY AUTO_INCREMENT, /* 주문번호 */
	MID VARCHAR(30) NOT NULL, /* ID */
	PID INT NOT NULL, /* 상품번호 */
	QUANTITY INT NOT NULL, /* 상품수량 */
	ODATE DATE, /* 주문날짜 */
	PRICE INT, /* 가격 */
	STATUSCODE VARCHAR(20) NOT NULL /* 상태코드 */
);

/* 주문상태 */
CREATE TABLE STATUSTYPE (
	STATUSCODE VARCHAR(20) PRIMARY KEY, /* 상태코드 */
	STATUSNAME VARCHAR(50) NOT NULL /* 상태명 */
);

/* 리뷰게시판 첨부 */
CREATE TABLE FILENAME_TBL (
	RNO INT PRIMARY KEY, /* 리뷰번호 */
	SAVEDFILENAME VARCHAR(1000) /* 새 컬럼 */
);

ALTER TABLE PRODUCT
	ADD FOREIGN KEY (
			TYPECODE
		)
		REFERENCES PRODUCTTYPE (
			TYPECODE
		);

ALTER TABLE POINT
	ADD
		FOREIGN KEY (
			MID
		)
		REFERENCES MEMBER (
			MID
		)
		ON DELETE CASCADE;

ALTER TABLE REVIEW
	ADD
		FOREIGN KEY (
			PID
		)
		REFERENCES PRODUCT (
			PID
		);

ALTER TABLE REVIEW
	ADD
		FOREIGN KEY (
			MID
		)
		REFERENCES MEMBER (
			MID
		);

ALTER TABLE REVIEWCOMMENT
	ADD
		FOREIGN KEY (
			RNO
		)
		REFERENCES REVIEW (
			RNO
		);

ALTER TABLE REVIEWCOMMENT
	ADD

		FOREIGN KEY (
			MID
		)
		REFERENCES MEMBER (
			MID
		);

ALTER TABLE COMMUNITY
	ADD FOREIGN KEY (
			MID
		)
		REFERENCES MEMBER (
			MID
		);

ALTER TABLE USERCART
	ADD	FOREIGN KEY (
			MID
		)
		REFERENCES MEMBER (
			MID
		);

ALTER TABLE USERCART
	ADD	FOREIGN KEY (
			PID
		)
		REFERENCES PRODUCT (
			PID
		);

ALTER TABLE USERORDER
	ADD	FOREIGN KEY (
			MID
		)
		REFERENCES MEMBER (
			MID
		);

ALTER TABLE USERORDER
	ADD	FOREIGN KEY (
			PID
		)
		REFERENCES PRODUCT (
			PID
		);

ALTER TABLE USERORDER
	ADD	FOREIGN KEY (
			STATUSCODE
		)
		REFERENCES STATUSTYPE (
			STATUSCODE
		);

ALTER TABLE FILENAME_TBL
	ADD	FOREIGN KEY (
			RNO
		)
		REFERENCES REVIEW (
			RNO
		);

/* 샘플 데이터 */
-- PRODUCTTYPE
INSERT INTO PRODUCTTYPE VALUES('1', '한식', 'Korean food');
INSERT INTO PRODUCTTYPE VALUES('2', '양식', 'Western Food');
INSERT INTO PRODUCTTYPE VALUES('3', '중식', 'Chinese Food');
INSERT INTO PRODUCTTYPE VALUES('4', '일식', 'Japanese Food');
INSERT INTO PRODUCTTYPE VALUES('5', '기타', 'etc');


-- 관리자 계정 생성
INSERT INTO MEMBER(MID, PW, MNAME, EMAIL, REGDATE, MLEVEL)
    VALUES('admin', '1111', '관리자', 'kh361@naver.com', now(), 2);
-- 관리자 계정 포인트 생성
INSERT INTO POINT
    VALUES('admin', 999999999, now());

-- STATUSTYPE
INSERT INTO STATUSTYPE Values ('1','주문 확인');
INSERT INTO STATUSTYPE Values ('2','상품 준비 중');
INSERT INTO STATUSTYPE Values ('3','배송 준비 중');
INSERT INTO STATUSTYPE Values ('4','배송 중');
INSERT INTO STATUSTYPE Values ('5','배송 완료');
INSERT INTO STATUSTYPE Values ('6','주문 취소');
INSERT INTO STATUSTYPE Values ('7','반품 처리');
INSERT INTO STATUSTYPE Values ('8','교환 처리');

-- COMMUNITY_FILE
CREATE TABLE COMMUNITY_FILE(
    FILE_NO INT PRIMARY KEY AUTO_INCREMENT,
    CNO INT NOT NULL,
    ORG_FILE_NAME VARCHAR(260) NOT NULL,
    STORED_FILE_NAME VARCHAR(36) NOT NULL,
    FILE_SIZE INT,
    REGDATE DATETIME DEFAULT current_timestamp,
    DEL_GB VARCHAR(1) DEFAULT 'N' NOT NULL
);
